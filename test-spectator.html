<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•è§‚æˆ˜åŠŸèƒ½</title>
    <script src="http://192.168.110.69:3001/socket.io/socket.io.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: white; }
        .log { background: #333; padding: 10px; margin: 10px 0; border-radius: 5px; }
        button { background: #4CAF50; color: white; padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        input { padding: 10px; margin: 5px; border-radius: 5px; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>è§‚æˆ˜åŠŸèƒ½æµ‹è¯•</h1>
    
    <div>
        <input type="text" id="roomId" placeholder="æˆ¿é—´ID" value="AHNCY4">
        <button onclick="joinRoom()">åŠ å…¥æˆ¿é—´</button>
        <button onclick="checkRoom()">æ£€æŸ¥æˆ¿é—´</button>
    </div>
    
    <div id="logs"></div>

    <script>
        const socket = io('http://192.168.110.69:3001');
        const logs = document.getElementById('logs');
        
        // ç”Ÿæˆè®¾å¤‡ID
        const deviceId = 'test_spectator_' + Math.random().toString(36).substr(2, 9);
        
        function log(message) {
            const div = document.createElement('div');
            div.className = 'log';
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logs.appendChild(div);
            logs.scrollTop = logs.scrollHeight;
        }
        
        // Socketäº‹ä»¶ç›‘å¬
        socket.on('connect', () => {
            log('âœ… è¿æ¥åˆ°æœåŠ¡å™¨æˆåŠŸ');
            // æ³¨å†Œè®¾å¤‡
            socket.emit('registerDevice', { deviceId });
            log(`ğŸ“± æ³¨å†Œè®¾å¤‡ID: ${deviceId}`);
        });
        
        socket.on('gameStateUpdate', (gameState) => {
            log(`ğŸ® æ¸¸æˆçŠ¶æ€æ›´æ–°: æˆ¿é—´${gameState.id}, ç©å®¶æ•°é‡${gameState.players.length}`);
            log(`   - æ¸¸æˆå¼€å§‹: ${gameState.gameStarted ? 'æ˜¯' : 'å¦'}`);
            if (gameState.gameState) {
                log(`   - æ¸¸æˆé˜¶æ®µ: ${gameState.gameState.phase}`);
            }
            gameState.players.forEach(player => {
                log(`   - ç©å®¶: ${player.nickname} (åº§ä½${player.seat}, ç­¹ç ${player.chips})`);
            });
        });
        
        socket.on('spectatorMode', (data) => {
            log(`ğŸ‘ï¸ è§‚æˆ˜æ¨¡å¼: ${data.message}`);
        });
        
        socket.on('waitingForNextRound', (data) => {
            log(`â³ ç­‰å¾…ä¸‹ä¸€è½®: ${data.message} (åº§ä½${data.seat})`);
        });
        
        socket.on('error', (message) => {
            log(`âŒ é”™è¯¯: ${message}`);
        });
        
        socket.on('disconnect', () => {
            log('âŒ ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥');
        });
        
        function joinRoom() {
            const roomId = document.getElementById('roomId').value;
            if (!roomId) {
                log('âŒ è¯·è¾“å…¥æˆ¿é—´ID');
                return;
            }
            
            log(`ğŸšª å°è¯•åŠ å…¥æˆ¿é—´: ${roomId}`);
            socket.emit('joinRoom', { roomId, deviceId, playerName: `è§‚ä¼—_${deviceId.substr(-4)}` });
        }
        
        function checkRoom() {
            const roomId = document.getElementById('roomId').value;
            if (!roomId) {
                log('âŒ è¯·è¾“å…¥æˆ¿é—´ID');
                return;
            }
            
            log(`ğŸ” æ£€æŸ¥æˆ¿é—´: ${roomId}`);
            fetch(`http://192.168.110.69:3001/api/rooms/${roomId}`)
                .then(response => response.json())
                .then(data => {
                    log(`âœ… æˆ¿é—´ä¿¡æ¯: ${JSON.stringify(data, null, 2)}`);
                })
                .catch(error => {
                    log(`âŒ æ£€æŸ¥æˆ¿é—´å¤±è´¥: ${error.message}`);
                });
        }
        
        log('ğŸ”§ æµ‹è¯•é¡µé¢å·²åŠ è½½ï¼Œç­‰å¾…è¿æ¥...');
    </script>
</body>
</html>
